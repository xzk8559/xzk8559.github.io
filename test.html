<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script type="module">

    //import * as THREE from "./three.js/build/three.module.js";

    // pos = [[0, 0], [1, 0], [0, 1], [1, 1]];
    function Node( pos ){

        this.index = [];
        this.pos = pos;
        this.level = 0;
        this.parent = null;
        this.children = [];
        this.object = [];
        this.visible = false;
        this.width = Math.abs((pos[0][0] - pos[1][0]));
        this.length = Math.abs((pos[0][1] - pos[2][1]));
        this.center = [(pos[0][0] + pos[1][0]) / 2, (pos[0][0] + pos[1][0]) / 2];

    }
    Node.prototype = {

        computeIndex: function(){
            this.index[0] = 0;
            this.index[1] = this.width;
            this.index[2] = (this.width + 1) * this.length;
            this.index[3] = (this.width + 1) * (this.length + 1) - 1;
        },
        setVisible: function(){
            this.visible = true;
        },
        computeSubNode: function(){

            let tmp = {
                down: [this.center[0], this.pos[0][1]],
                up: [this.center[0], this.pos[2][1]],
                left: [this.pos[0][0], this.center[1]],
                right: [this.pos[1][0], this.center[1]],
                center: this.center,
                idn: (this.index[0] + this.index[1]) / 2,
                iup: (this.index[2] + this.index[3]) / 2,
                ile: (this.index[0] + this.index[2]) / 2,
                iri: (this.index[1] + this.index[3]) / 2,
                ice: (this.index[0] + this.index[1] + this.index[2] + this.index[3]) / 4
            };

            let subNode = [];
            let subPos = [];
            let subIndex = [];

            subPos.push( [this.pos[0], tmp.down, tmp.left, tmp.center] ); // subNode0
            subPos.push( [tmp.down, this.pos[1], tmp.center, tmp.right] ); // subNode1
            subPos.push( [tmp.left, tmp.center, this.pos[2], tmp.up] ); // subNode2
            subPos.push( [tmp.center, tmp.right, tmp.up, this.pos[3]] ); // subNode3

            subIndex.push( [this.index[0], tmp.idn, tmp.ile, tmp.ice] );
            subIndex.push( [tmp.idn, this.index[1], tmp.ice, tmp.iri] );
            subIndex.push( [tmp.ile, tmp.ice, this.index[2], tmp.iup] );
            subIndex.push( [tmp.ice, tmp.iri, tmp.iup, this.index[3]] );

            for (let i = 0; i < 4; i++) {

                subNode.push( new Node(subPos[i]) );
                subNode[i].index = subIndex[i];
                subNode[i].parent = this;
                subNode[i].level = this.level + 1;
            }

            this.children = subNode;

        }

    };

    let node = new Node( [[0, 0], [1, 0], [0, 1], [1, 1]] );
    node.computeIndex();

    function buildTree( nodeList, iteration ){

        for (let i = 0; i < nodeList.length; i++){
            nodeList[i].computeSubNode();
            if (nodeList[i].children[0].level < iteration){
                buildTree( nodeList[i].children, iteration );
            }
        }
    }

    buildTree( [node], 6 );
    console.log(node);


</script>
</body>
</html>